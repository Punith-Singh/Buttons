<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cart Animation Button</title>
<style>
  * {
    box-sizing: border-box;
  }

  body {
    height: 100vh;
    margin: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    background: radial-gradient(circle at top left, #1e1e2f, #0f0f1b);
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  }

  .cart-button {
    position: relative;
    width: 220px;
    height: 64px;
    border: none;
    border-radius: 50px;
    background: #2a2a3e; /* Dark base color */
    color: #fff;
    font-size: 17px;
    font-weight: 600;
    letter-spacing: 0.5px;
    cursor: pointer;
    box-shadow: 0 0 25px rgba(0, 123, 255, 0.4);
    overflow: hidden; /* This is key! */
    transition: all 0.4s ease;
    user-select: none;
  }

  .cart-button:hover {
    box-shadow: 0 0 35px rgba(0, 123, 255, 0.8);
    transform: translateY(-2px);
  }

  /* We use two content containers to slide between states */
  .content {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    transition: transform 0.5s cubic-bezier(0.65, 0, 0.35, 1), opacity 0.4s ease;
    white-space: nowrap;
    z-index: 1; /* Set z-index to slide *behind* the door */
  }

  .initial-content {
    transform: translateX(0%);
    opacity: 1;
  }
  
  /* Added separate classes for icon and text */
  .initial-cart-icon {
    transition: transform 0.5s cubic-bezier(0.65, 0, 0.35, 1), opacity 0.4s ease;
    transform: translateX(0);
  }
  
  .initial-cart-text {
    transition: opacity 0.3s ease;
    opacity: 1;
  }

  .complete-content {
    /* Starts off-screen to the right */
    transform: translateX(100%);
    opacity: 0;
    gap: 8px; /* Tighter gap */
  }

  /* SVGs for cart and checkmark */
  .cart-icon,
  .checkmark-icon {
    width: 28px;
    height: 28px;
    fill: none;
    stroke: currentColor;
    stroke-width: 2;
    stroke-linecap: round;
    stroke-linejoin: round;
    flex-shrink: 0;
  }

  .checkmark-icon {
    stroke-width: 3;
  }
  
  /* This is the "door", styled to look like an inset slot */
  .loading-bar {
    position: absolute;
    right: 20px; /* Position from right */
    top: 50%;
    
    /* Make it look like an inset "door" or "slot" */
    width: 32px; /* Wide enough for the 28px icon */
    height: 40px; /* Taller than the icon */
    
    /* Brown door color with a subtle radial gradient */
    background: radial-gradient(circle at top left, #6b4c30, #4a3321);
    border-radius: 8px; /* Slightly increased border-radius */
    
    /* Inset shadow to give depth + original glow */
    box-shadow: inset 0 0 10px rgba(0,0,0,0.8), 0 0 15px rgba(139, 69, 19, 0.6); 

    /* Animation properties */
    transform: translateY(-50%) scaleX(0); /* Start hidden */
    transform-origin: right center; /* Grow from the right */
    opacity: 0;
    transition: all 0.4s ease;
    z-index: 2; /* Position *above* the icon content */
  }

  /* Door Handle */
  .loading-bar::after {
    content: '';
    position: absolute;
    left: 5px; /* Position on the left side of the door */
    top: 50%;
    transform: translateY(-50%);
    width: 6px; /* Small handle width */
    height: 12px; /* Small handle height */
    background: linear-gradient(to bottom, #cccccc, #888888); /* Silver gradient */
    border-radius: 2px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.4);
  }


  /* --- Animation states --- */

  /* 1. LOADING */
  /* Text fades out */
  .cart-button.loading .initial-cart-text {
    opacity: 0;
  }
  
  /* Cart icon slides right into the door */
  .cart-button.loading .initial-cart-icon {
    /* This value moves the icon's center to the "door's" center */
    transform: translateX(124px); 
    opacity: 0;
    /* Delay the fade out so it's seen sliding *behind* the door */
    transition: transform 0.5s cubic-bezier(0.65, 0, 0.35, 1), opacity 0.4s ease 0.15s;
  }

  .cart-button.loading .loading-bar {
    opacity: 1;
    transform: translateY(-50%) scaleX(1); /* Bar appears */
    /* Delay its appearance slightly to match text fade */
    transition-delay: 0.1s; 
  }
  
  /* --- THIS IS THE FIX --- */
  /* When "added" is active, instantly move the initial content
     off-screen to the right, so it's ready for the reset animation. */
  .cart-button.added .initial-content {
    transform: translateX(100%);
    opacity: 0;
    /* This prevents it from animating from its "loading" position */
    transition-property: transform, opacity;
    transition-duration: 0s;
  }
  
  /* Also reset the icon's internal transform when "added" */
  .cart-button.added .initial-cart-icon {
      transform: translateX(0);
      opacity: 1; /* Opacity is controlled by parent */
      transition: none;
  }
  .cart-button.added .initial-cart-text {
      opacity: 1; /* Opacity is controlled by parent */
      transition: none;
  }
  
  /* 2. ADDED */
  .cart-button.added {
    background: rgba(0, 255, 170, 0.15);
    box-shadow: 0 0 30px rgba(0, 255, 170, 0.4);
    color: #00ffaa;
  }

  .cart-button.added .loading-bar {
    opacity: 0;
    transform: translateY(-50%) scaleX(0); /* Bar disappears */
  }
  
  .cart-button.added .complete-content {
    transform: translateX(0%); /* Slide in from right */
    opacity: 1;
    transition-delay: 0.1s;
  }

  /* 3. RESETTING */
  .cart-button.resetting .complete-content {
    transform: translateX(-100%); /* Slide out left */
    opacity: 0;
  }
  
  .cart-button.resetting .initial-content {
    transform: translateX(0%); /* Slide in from right */
    opacity: 1;
    /* Re-enable the transition that we disabled in the ".added" state */
    transition: transform 0.5s cubic-bezier(0.65, 0, 0.35, 1), opacity 0.4s ease;
    transition-delay: 0.2s;
  }
  
  .cart-button.resetting {
    background: #2a2a3e;
    box-shadow: 0 0 25px rgba(0, 123, 255, 0.4);
    color: #fff;
  }

</style>
</head>
<body>

  <button class="cart-button">
    
    <!-- Initial State Content --><div class="content initial-content">
      <svg class="cart-icon initial-cart-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <circle cx="9" cy="21" r="1"></circle>
        <circle cx="20" cy="21" r="1"></circle>
        <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
      </svg>
      <span class="initial-cart-text">Add to Cart</span>
    </div>
    
    <!-- Loading Bar (the "door") --><div class="loading-bar"></div>

    <!-- Complete State Content --><div class="content complete-content">
      <svg class="checkmark-icon" viewBox="0 0 24 24">
        <path d="M4 12l6 6L20 6"></path>
      </svg>
      <span>Added!</span>
    </div>

  </button>

<script>
  const btn = document.querySelector('.cart-button');
  let isLoading = false;
  let isAdded = false;

  btn.addEventListener('click', () => {
    if (isLoading) return;

    if (isAdded) {
      // --- RESET THE BUTTON ---
      isLoading = true;
      btn.classList.add('resetting');
      btn.classList.remove('added');

      setTimeout(() => {
        btn.classList.remove('resetting');
        isLoading = false;
        isAdded = false;

        // --- Clean up inline styles for a clean reset ---
        // REMOVED the conflicting style manipulation.
        // The CSS classes handle this animation automatically.
        
      }, 800); // Duration of reset animation
    } else {
      // --- START THE LOADING PROCESS ---
      isLoading = true;
      btn.classList.add('loading');

      setTimeout(() => {
        btn.classList.remove('loading');
        btn.classList.add('added');
        isLoading = false;
        isAdded = true;
      }, 1200); // This is the "loading" time
    }
  });
</script>

</body>
</html>
